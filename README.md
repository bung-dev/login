# Login-Step-by-Step-Project
<img width="800" height="500" alt="image" src="https://github.com/user-attachments/assets/bbaf10c2-26ca-4ebc-a5c2-66a67b7b8289" />


## Status (Last updated: 2026-01-22)

- âœ… Cookie ë¡œê·¸ì¸ êµ¬í˜„
- âœ… Session ë¡œê·¸ì¸ êµ¬í˜„
- âœ… Interceptor / ArgumentResolver ê¸°ë°˜ ë¡œê·¸ì¸ ì£¼ì…(@Login) + ì˜ˆì™¸ ê³µí†µ ì²˜ë¦¬ + Bean Validation
- âœ… JPA Refactoring ì™„ë£Œ
- âœ… Soft Delete(ë…¼ë¦¬ ì‚­ì œ) ì ìš©
- âœ… Legacy ì½”ë“œ ê²©ë¦¬(í•™ìŠµ ë‹¨ê³„ êµ¬í˜„ ë³´ê´€ + í˜„ì¬ ëŸ°íƒ€ì„ ì œì™¸)
- âœ… ErrorResponse.of(...) ë„ì…(ì—ëŸ¬ ì‘ë‹µ ìƒì„± í†µì¼)
- âœ… Spring Security 401/403 ì˜ˆì™¸ JSON ì‘ë‹µ ì²˜ë¦¬(EntryPoint/DeniedHandler)
- âœ… CustomUserDetails/Service êµ¬í˜„ + @AuthenticationPrincipal ê¸°ë°˜ â€œë‚´ ì •ë³´â€ ì²˜ë¦¬
- âœ… JWT ì¸ì¦(Access Token only) ì ìš©
  - âœ… LoginFilter ì œê±° â†’ Controller/Service ê¸°ë°˜ í† í° ë°œê¸‰ìœ¼ë¡œ ì „í™˜
- â³ Refresh Token êµ¬í˜„ ì˜ˆì •
- â³ OAuth2 Login + JWT í†µí•© ì˜ˆì •


---

## 1. Cookie ë¡œê·¸ì¸

- ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ì„œë²„ê°€ ì¿ í‚¤ì— ì‚¬ìš©ì ì •ë³´ë¥¼ ë‹´ì•„ ì‘ë‹µ
- í´ë¼ì´ì–¸íŠ¸ëŠ” ì´í›„ ìš”ì²­ë§ˆë‹¤ ì¿ í‚¤ë¥¼ í•¨ê»˜ ì „ì†¡
- ì„œë²„ëŠ” ì¿ í‚¤ë¥¼ í†µí•´ ë¡œê·¸ì¸ ì—¬ë¶€ë¥¼ íŒë‹¨

### ResponseCookie
- ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ 5.0ë¶€í„° ì§€ì›í•˜ë©° ì‘ë‹µ í—¤ë”ì— í—ˆìš©ê°€ëŠ¥
 - ex) ë§¤ê°œë³€ìˆ˜ë¡œ HttpServletResponseë¥¼ ë°›ì•„ response.addCookie(cookie)ë¥¼ í•˜ì§€ì•Šê³  ResponseEntity.ok().header(HttpHeaders.SET_COOKIE, cookie.toString())ê°€ëŠ¥
---

## Cookie ë¡œê·¸ì¸ í•œê³„

- ì¿ í‚¤ì— ì •ë³´ê°€ ì§ì ‘ ì €ì¥ë¨
- íƒˆì·¨ ë° ìœ„Â·ë³€ì¡° ìœ„í—˜
- ë³´ì•ˆ ì¸¡ë©´ì—ì„œ í•œê³„ê°€ ìˆìŒ

â†’ Session ë¡œê·¸ì¸ ë°©ì‹ìœ¼ë¡œ ì „í™˜

---

## 2. Session ë¡œê·¸ì¸

- ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ì„œë²„ì—ì„œ ì„¸ì…˜ ìƒì„±
- ì„¸ì…˜ì€ Key-Value êµ¬ì¡°
  - Key: ì„¸ì…˜ ID (ì¤‘ë³µë˜ì§€ ì•ŠëŠ” ê³ ìœ í•œ ê°’)
  - Value: ì‚¬ìš©ì ì •ë³´
- ì„¸ì…˜ IDë§Œ ì¿ í‚¤ì— ë‹´ì•„ ì‘ë‹µ
- ì´í›„ ìš”ì²­ ì‹œ ì„¸ì…˜ IDë¡œ ì¸ì¦ ì²˜ë¦¬

- `HttpSession` ì‚¬ìš©

---

## 3. Interceptor/ArgumentResolver + CustomException

### Interceptor / ArgumentResolver
- ë¡œê·¸ì¸ ì—¬ë¶€ í™•ì¸ì„ ìœ„í•´ `LoginCheckInterceptor` ì‚¬ìš©
- `@Login` ì»¤ìŠ¤í…€ ì–´ë…¸í…Œì´ì…˜ êµ¬í˜„

### Custom Exception
- ì˜ˆì™¸ë¥¼ í•œ ê³³ì—ì„œ ê´€ë¦¬
- ì‘ë‹µ í¬ë§· í†µì¼

### Bean Validation
- ìš”ì²­ ê°’ ê²€ì¦ì„ ìœ„í•´ Bean Validation ì ìš©

---

## @Login + HandlerMethodArgumentResolverë¥¼ ì‚¬ìš©í•œ ì´ìœ 

<img width="774" height="152" alt="image" src="https://github.com/user-attachments/assets/44edb9ac-593f-4d46-80f0-ed20702f3f72" />

ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ HttpSessionì„ ì§ì ‘ ì¡°íšŒí•˜ì§€ ì•Šê³ , @Loginìœ¼ë¡œ ë¡œê·¸ì¸ ì •ë³´ë¥¼ ì£¼ì…ë°›ë„ë¡ êµ¬ì„±

ë‹¨ìˆœ ì¡°íšŒëŠ” ì„¸ì…˜ DTO ì‚¬ìš©(ë¶ˆí•„ìš”í•œ DB ì¡°íšŒ ë°©ì§€)

ì¤‘ìš”í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§(ì •ë³´ ë³€ê²½/ê²°ì œ ë“±)ì€ ìµœì‹  ì—”í‹°í‹° ì¡°íšŒë¡œ ì •í•©ì„± í™•ë³´
â†’ â€œê°€ë²¼ìš´ ìš”ì²­â€ê³¼ â€œì¤‘ìš”í•œ ìš”ì²­â€ì„ ë¶„ë¦¬

---

## 4. JPA Refactoring + Soft Delete

### 4-1. JPA Refactoring 

#### ì™œ ë°”ê¿¨ëŠ”ê°€
- (ì´ì „) ê°„ë‹¨í•œ ì €ì¥ ë°©ì‹(ë©”ëª¨ë¦¬/Map ê¸°ë°˜)ì€ í•™ìŠµì—ëŠ” ì¢‹ì§€ë§Œ, ê¸°ëŠ¥ì´ ëŠ˜ì–´ë‚˜ë©´ ì¡°íšŒ ì¡°ê±´/ë™ì‹œì„±/íŠ¸ëœì­ì…˜ ê°™ì€ ìš´ì˜ ì´ìŠˆë¥¼ ë‹¤ë£¨ê¸° ì–´ë µë‹¤
- (ëª©í‘œ) â€œë°ì´í„°ëŠ” DB, ë¹„ì¦ˆë‹ˆìŠ¤ëŠ” ì„œë¹„ìŠ¤, ì ‘ê·¼ì€ Repositoryâ€ë¡œ ì±…ì„ì„ ë¶„ë¦¬í•´ í™•ì¥ ê°€ëŠ¥í•œ í˜•íƒœë¡œ ì •ë¦¬í•œë‹¤

#### ë¬´ì—‡ì„ ë°”ê¿¨ëŠ”ê°€
- Entity ì¤‘ì‹¬ìœ¼ë¡œ ë„ë©”ì¸ ëª¨ë¸ì„ ì •ë¦¬í•˜ê³ , Repository(JpaRepository)ë¡œ ë°ì´í„° ì ‘ê·¼ì„ ì¼ì›í™”í•œë‹¤
- Service ê³„ì¸µì—ì„œ íŠ¸ëœì­ì…˜ ê²½ê³„ë¥¼ ëª…í™•íˆ í•œë‹¤
  - ì“°ê¸° ë¡œì§: @Transactional
  - ì¡°íšŒ ë¡œì§: @Transactional(readOnly = true)
- ë¦¬íŒ©í† ë§ ì´í›„ ë™ì‘ì´ ê¹¨ì§€ì§€ ì•Šë„ë¡ í…ŒìŠ¤íŠ¸ë¥¼ ì¶”ê°€í•œë‹¤

#### ì–»ì€ ê²ƒ / íŠ¸ë ˆì´ë“œì˜¤í”„
- ì¥ì : ì¡°íšŒ/ì €ì¥ ë¡œì§ì´ í‘œì¤€í™”ë˜ê³ , â€œìˆ˜ì •/ì‚­ì œ/ì¡°íšŒâ€ê°€ ê¸°ëŠ¥ ë‹¨ìœ„ë¡œ ì˜ˆì¸¡ ê°€ëŠ¥í•´ì§„ë‹¤
- ë‹¨ì : ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸/ì§€ì—° ë¡œë”©/íŠ¸ëœì­ì…˜ ë²”ìœ„ ê°™ì€ JPA íŠ¹ì„±ì„ ì´í•´í•˜ê³  ì„¤ê³„ì— ë°˜ì˜í•´ì•¼ í•œë‹¤

---

### 4-2. Soft Delete(ë…¼ë¦¬ ì‚­ì œ) ì ìš© 

#### ì™œ ë„£ì—ˆëŠ”ê°€
- ìš´ì˜ì—ì„œëŠ” â€œì‹¤ìˆ˜ë¡œ ì‚­ì œâ€ê°€ ë¹ˆë²ˆí•˜ê³ , ì‚­ì œ ì´ë ¥/ë³µêµ¬ ìš”êµ¬ê°€ ìƒê¸´ë‹¤
- ë¬¼ë¦¬ ì‚­ì œëŠ” FK/ì´ë ¥(Audit)/ì¥ì•  ëŒ€ì‘ ê´€ì ì—ì„œ ë¦¬ìŠ¤í¬ê°€ ì»¤ì§„ë‹¤

#### ë¬´ì—‡ì„ í–ˆëŠ”ê°€(í•µì‹¬ ì•„ì´ë””ì–´)
- delete ìš”ì²­ì´ ì™€ë„ ì‹¤ì œ DELETE ëŒ€ì‹  deletedAt ê°’ì„ ì—…ë°ì´íŠ¸í•œë‹¤
- ê¸°ë³¸ ì¡°íšŒì—ì„œëŠ” ì‚­ì œ ë°ì´í„°ê°€ ìë™ìœ¼ë¡œ ì œì™¸ë˜ë„ë¡ â€œì „ì—­ ì¡°ê±´â€ì„ ì ìš©í•œë‹¤
- ê´€ë¦¬ì/ë³µêµ¬ì²˜ëŸ¼ â€œì‚­ì œ í¬í•¨ ì¡°íšŒâ€ê°€ í•„ìš”í•œ ì¼€ì´ìŠ¤ëŠ” ë³„ë„ ì¿¼ë¦¬ë¡œ ë¶„ë¦¬í•œë‹¤

---

## 5. Spring Security ì ìš© + Member API (WIP)

### 5-1. Legacy ì½”ë“œ ê²©ë¦¬
- ì„¸ì…˜/ì¸í„°ì…‰í„°/ArgumentResolver ë°©ì‹ì€ legacy íŒ¨í‚¤ì§€ë¡œ ë¬¶ê³ ,
  ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” ë²”ìœ„ë¥¼ memberë¡œ ì œí•œí•´ í˜„ì¬ ëŸ°íƒ€ì„ì—ì„œ ì œì™¸í–ˆë‹¤.

### 5-2. ì—ëŸ¬ ì‘ë‹µ ìƒì„± í†µì¼
- ErrorResponse.of(...) ì •ì  íŒ©í† ë¦¬ë¥¼ ë„ì…í•´
  GlobalExceptionHandlerì—ì„œ new ìƒì„± ëŒ€ì‹  of ìƒì„±ìë¡œ ì‘ë‹µ ìƒì„± ë¡œì§ì„ í†µì¼í–ˆë‹¤.

### 5-3. Security 401/403 JSON ì‘ë‹µ + ì¸ì¦ ì£¼ì²´(PK) ì²˜ë¦¬
- 401: RestAuthenticationEntryPoint, 403: RestAccessDeniedHandler êµ¬í˜„ìœ¼ë¡œ ë³´ì•ˆ ì˜ˆì™¸ë„ JSONìœ¼ë¡œ í‘œì¤€í™”í–ˆë‹¤.
- CustomMemberDetailsì— memberId(PK) ì ‘ê·¼ ë©”ì„œë“œë¥¼ ì¶”ê°€í•˜ê³ ,
  @AuthenticationPrincipalë¡œ ì£¼ì…ë°›ì•„ ë‚´ ì •ë³´ ì¡°íšŒ/ìˆ˜ì •/ì‚­ì œë¥¼ PK ê¸°ë°˜ìœ¼ë¡œ ì²˜ë¦¬í•œë‹¤.
  > ì¸ì¦ ì£¼ì²´ ì‹ë³„ì€ loginId/email ëŒ€ì‹  PK(memberId)ë¡œ í†µì¼í–ˆë‹¤.
  > ì™¸ë¶€ ì‹ë³„ìëŠ” ë³€ê²½/ì¤‘ë³µ/ì •ê·œí™” ì´ìŠˆê°€ ë°œìƒí•˜ê¸° ì‰¬ì›Œ ìš´ì˜ì—ì„œ ì •í•©ì„±ì„ í”ë“¤ ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤.

### 5-4. JWT (Access Token only) - Spring Security ì²˜ë¦¬ íë¦„
- LoginFilterê°€ ë¡œê·¸ì¸ ìš”ì²­ì„ ì²˜ë¦¬í•˜ê³ , ì¸ì¦ ì„±ê³µ ì‹œ JWTUtilë¡œ Access Tokenì„ ë°œê¸‰í•œë‹¤.
- ì´í›„ ìš”ì²­ì€ JWTFilterê°€ Authorization: Bearer <token>ì„ ì¶”ì¶œí•´ JWTUtilë¡œ ê²€ì¦í•œë‹¤.
- í† í°ì´ ìœ íš¨í•˜ë©´ CustomMemberDetailsService/CustomMemberDetails ê¸°ë°˜ìœ¼ë¡œ Authenticationì„ ë§Œë“¤ì–´ SecurityContextì— ì €ì¥í•œë‹¤.

### 5-5. LoginFilter ì œê±° â†’ Controller/Service ê¸°ë°˜ í† í° ë°œê¸‰ ì „í™˜

- ê¸°ì¡´ì—ëŠ” LoginFilterì—ì„œ ì¸ì¦ ì„±ê³µ ì‹œ í† í°ì„ ë°œê¸‰í–ˆì§€ë§Œ, í˜„ì¬ëŠ” AuthController â†’ AuthServiceì—ì„œ ë°œê¸‰í•˜ë„ë¡ ë¦¬íŒ©í† ë§í–ˆë‹¤.
- /login ìš”ì²­ì€ AuthenticationManager.authenticate(...)ë¡œ ì¸ì¦ì„ ìˆ˜í–‰í•˜ê³ , ì„±ê³µ ì‹œ JWTUtil.createTokenìœ¼ë¡œ Access Tokenì„ ìƒì„±í•œë‹¤.
- ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì„œë¹„ìŠ¤ë§Œ ì˜ì¡´í•˜ë„ë¡ êµ¬ì„±í•´(ControllerëŠ” I/O, ServiceëŠ” ë¡œì§) ì±…ì„ì„ ë¶„ë¦¬í–ˆë‹¤.
- í† í° ìŠ¤í™(ë§Œë£Œ/í—¤ë”/ì´ë¦„)ì€ CommonTokenìœ¼ë¡œ ìƒìˆ˜í™”í•´ ì¼ê´€ë˜ê²Œ ê´€ë¦¬í•œë‹¤.
  
## Current Focus (WIP)

- Refresh Token ì„¤ê³„/êµ¬í˜„(ì¬ë°œê¸‰ í”Œë¡œìš° í¬í•¨)
- OAuth2 Login ì ìš© í›„ JWTì™€ í†µí•©

---


## ğŸ“Œ Commit Convention

| ì´ëª¨ì§€ | íƒœê·¸ | ì„¤ëª… |
|------|------|------|
| âœ¨ | feat | ê¸°ëŠ¥ ì¶”ê°€ |
| ğŸ› | fix | ë²„ê·¸ ìˆ˜ì • |
| ğŸ“ | docs | ë¬¸ì„œ ìˆ˜ì • |
| ğŸ’„ | style | í¬ë§· ìˆ˜ì • (ê¸°ëŠ¥ ë³€ê²½ ì—†ìŒ) |
| â™»ï¸ | refactor | êµ¬ì¡° ê°œì„  |
| âœ… | test | í…ŒìŠ¤íŠ¸ ì½”ë“œ |
| ğŸ”§ | chore | ì„¤ì • ë° ê¸°íƒ€ ì‘ì—… |

## Tech Stack

- Language: Java
- Framework: Spring Boot
- Persistence: Spring Data JPA
- Security: Spring Security (WIP), JWT (Planned), OAuth2 (Planned)
- Database: MySQL, H2
- Build Tool: Gradle
- Test: JUnit

